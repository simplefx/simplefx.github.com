<!DOCTYPE HTML>
<html lang="en">
<head>
    <title>The Where Method</title>
</head>
<body>
    <h2>
        Where</h2>
    <p>
        Use the <em>Where</em> method to add further filtering criteria to a <code class="type">
            SimpleQuery</code>. If criteria already exist, old and new criteria are combined
        with the <code class="operator">AND</code> operator.</p>
    <h3>
        Syntax</h3>
    <pre class="brush:csharp">public ICommand Where(
		SimpleExpression criteria
	)</pre>
    <h4>
        Parameters</h4>
    <dl>
        <dt><code class="parameter">criteria</code></dt>
        <dd>
            Type: <code class="type">SimpleExpression</code><br>
            A (concatenated sequence of) search criteria. For example, <code>dbo.Album.GenreId == 1</code>.</dd></dl>
    <h4>
        Return Value</h4>
    <p>
        Type: <code class="interface">ICommand</code><br>
        An object representation of the data retrieval query to be sent to a data store</p>
    <h3>
        Exceptions</h3>
    <table>
        <tr>
            <th>
                Exception
            </th>
            <th>
                Condition
            </th>
        </tr>
        <tr>
        	<td><code class="type">RuntimeBinderException</code></td>
        	<td><code class="method">Where</code> called without a query command to qualify</td>
        </tr>
        <tr>
        	<td><code class="type">System.Reflection.TargetParameterCountException</code></td>
        	<td>Zero or more than one <code class="type">SimpleExpression</code>s have been supplied to <code class="method">Where</code> as parameters</td>
        </tr>
        <tr>
            <td>
                <code class="type">FormatException</code><br />
                <em>- or -</em><br />
                <code class="type">RuntimeBinderException</code><br />
                <em>- or -</em><br />
                <code class="type">Simple.Data.UnresolvableObjectException</code>
            </td>
            <td>
                Malformed <code class="type">SimpleExpression</code> supplied to <code class="method">Where</code> as parameter
            </td>
        </tr>
    </table>
    <h3>
        Remarks</h3>
        <p>Using the <code class="method">Where</code> method allows you to add to the filtering criteria you may have already given your
        	<code class="method">Find*</code>, <code class="method">Add</code> and <code class="method">Get</code> queries. For example, the following commands all produce the same SQL.</p> 
<pre class="brush:csharp">db.Albums
    .FindAllByGenreId(1)
    .Select(db.Albums.Title)
    .Where(db.Albums.AlbumId > 400);
    
db.Albums
    .FindAll(db.Albums.GenreId == 1 && db.Albums.AlbumId > 400)
    .Select(db.Albums.Title);
    
db.Albums
    .All()
    .Select(db.Albums.Title)
    .Where(db.Albums.GenreId == 1 && db.Albums.AlbumId > 400);</pre>     
        <p>You must call <code class="method">Where</code> with a single valid <code class="type">SimpleExpression</code> 
        as a parameter else an <code class="object">Exception</code> will be thrown.</p>
        <p>You can find examples of setting common search conditions as <code class="type">SimpleExpression</code>s here</p>
<h4>Building Complex SimpleExpressions</h4>
<p><code class="method">Where</code> takes a single <code class="type">SimpleExpression</code> as a parameter. 
If the command it is qualifying already has filtering criteria on it, the new criteria is appending to the old 
using the <code class="operator">AND</code> operator. For example, both these commands:</p>
<pre class="brush:csharp">db.Albums
    .All()
    .Select(db.Albums.Title)
    .Where(db.Albums.GenreId == 1 || db.Albums.GenreId == 2)
    .Where(db.Albums.ArtistId == 120);
    	
    db.Albums
    .FindAll(db.Albums.GenreId == 1 || db.Albums.GenreId == 2)
    .Select(db.Albums.Title)
    .Where(db.Albums.ArtistId == 120);</pre>
<p>produce the following SQL. Note that parentheses are generated to maintain the correct interpretation of each filter criteria.</p>
<pre class="brush:sql">select [dbo].[Album].[Title]
FROM [dbo].[Album] 
WHERE (
    ([dbo].[Album].[GenreId] = @p1 OR [dbo].[Album].[GenreId] = @p2) 
	AND [dbo].[Album].[ArtistId] = @p3)

@p1 (Int32) = 1
@p2 (Int32) = 2
@p3 (Int32) = 120</pre>
<p>If you wish to build up a set of filter criteria based on a set of business rules however, you may find it easier to build 
	up a <code class="type">SimpleExpression</code> separately and then add it to the command with a single call to Where rather than multiple calls. For example,</p>
<pre class="brush:csharp">var expr1 = db.Albums.GenreId == 1;
var expr2 = db.Albums.GenreId == 2;
var expr3 = db.Albums.ArtistId == 120;
return db.Albums.All().Where((expr1 || expr2) && expr3);</pre>
<p>This approach has the added advantage that you can concatenate <code class="type">SimpleExpression</code>s with <code class="operator">OR</code> as well as <code class="operator">AND</code>.</p>
</body>
</html>
