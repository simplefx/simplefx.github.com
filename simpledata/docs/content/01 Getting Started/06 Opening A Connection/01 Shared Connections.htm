<!DOCTYPE html>
<html>
<head>
  <title>Using a Shared Connection</title>
</head>
<body>
<h2>Using a Shared Connection</h2>
<p><strong>[ADOAdapter Only]</strong></p>
<p>SImple.Data&#8217;s aggressive attitude to closing database connections may not be optimal for you, but it is possible to</p> 
<ul>
	<li>create and open a connection outside of Simple.Data (e.g. a SqlConnection)</li>
	<li>force Simple.Data to share that one open connection across all its databases operations</li>
	<li>close the connection at your discretion</li>
</ul> 
<p>The Simple.Data.Ado adaptor includes the <strong>UseSharedConnection()</strong> and <strong>StopUsingSharedConnection()</strong> methods for this purpose</p> 
 <pre class="brush:csharp">public readonly string MagicConnection =
 	  @"Data Source=.\SQL2K8;Initial Catalog=MvcMusicStore;Integrated Security=True";
 	
var db = Database.OpenConnection(MagicConnection);
SqlConnection conn = new SqlConnection(MagicConnection);
conn.Open();
db.UseSharedConnection(conn);

var artist = db.Artists.FindByName("Aerosmith");
Console.WriteLine("Id: {0}, Name: {1}", artist.ArtistId, artist.Name);

var artist2 = db.Artists.FindByName("Metallica");
Console.WriteLine("Id: {0}, Name: {1}", artist2.ArtistId, artist2.Name);

var artist3 = db.Artists.FindByName("Iron Maiden");
Console.WriteLine("Id: {0}, Name: {1}", artist3.ArtistId, artist3.Name);

db.StopUsingSharedConnection();
conn.Close();</pre>
</body>
</html>
